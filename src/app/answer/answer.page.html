<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/teacher-dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ selectedAnswerSheet ? 'Edit' : 'Create' }} Answer Sheet</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Answer Sheet Form -->
  <form (ngSubmit)="selectedAnswerSheet ? updateAnswerSheet() : saveAnswerSheet()" #answerForm="ngForm">
    <ion-item>
      <ion-label position="floating">Exam Title</ion-label>
      <ion-input [(ngModel)]="examTitle" name="examTitle" required></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Subject</ion-label>
      <ion-input [(ngModel)]="subject" name="subject" required></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Grade Level</ion-label>
      <ion-input [(ngModel)]="gradeLevel" name="gradeLevel" required></ion-input>
    </ion-item>

    <!-- Number of Questions + Generate Button -->
    <ion-grid>
      <ion-row class="ion-align-items-center">
        <ion-col size="8">
          <ion-item>
            <ion-label position="floating">Number of Questions</ion-label>
            <ion-input
              type="number"
              [(ngModel)]="numQuestions"
              name="numQuestions"
              required>
            </ion-input>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-button expand="block" color="medium" (click)="generateAnswerFields()" [disabled]="!numQuestions || numQuestions <= 0">
            Generate
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Answer Key Input -->
    <ion-list *ngIf="questions.length > 0">
      <ion-item-divider>
        <ion-label>Answer Key</ion-label>
      </ion-item-divider>

      <ion-grid>
        <ion-row *ngFor="let question of questions; let i = index">
          <ion-col size="8">
            <ion-label class="ion-padding-start">Question {{ i + 1 }}</ion-label>
          </ion-col>
          <ion-col size="4">
            <ion-select [(ngModel)]="questions[i].answer" name="questionAnswer{{i}}" interface="popover" required>
              <ion-select-option *ngFor="let option of answerOptions" [value]="option">
                {{ option }}
              </ion-select-option>
            </ion-select>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-list>

    <ion-button expand="block" type="submit" class="ion-margin-top">
      {{ selectedAnswerSheet ? 'Update' : 'Save' }} Answer Sheet
    </ion-button>
  </form>

  <!-- Saved Answer Sheets List -->
  <ion-list *ngIf="answerSheets.length > 0" class="ion-margin-top">
    <ion-item-divider>
      <ion-label>Saved Answer Sheets</ion-label>
    </ion-item-divider>

    <ion-item *ngFor="let sheet of answerSheets">
      <ion-label>
        <h2>{{ sheet.examTitle }}</h2>
        <p><strong>Subject:</strong> {{ sheet.subject }}</p>
        <p><strong>Grade Level:</strong> {{ sheet.gradeLevel }}</p>

        <p><strong>Questions:</strong></p>
        <ul style="margin-left: 1rem;">
          <li *ngFor="let question of sheet.questions">
            Q{{ question.questionNumber }}: {{ question.answer }}
          </li>
        </ul>
      </ion-label>
      <ion-buttons slot="end">
        <ion-button fill="outline" (click)="editAnswerSheet(sheet)">Edit</ion-button>
        <ion-button color="danger" fill="outline" (click)="deleteAnswerSheet(sheet.id)">Delete</ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>
</ion-content>
